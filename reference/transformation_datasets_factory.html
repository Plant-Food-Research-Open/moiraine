<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a list of targets to apply some transformation methods to one or more
datasets in a MultiDataSet object."><title>Target factory for datasets transformation — transformation_datasets_factory • moiraine</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Target factory for datasets transformation — transformation_datasets_factory"><meta property="og:description" content="Create a list of targets to apply some transformation methods to one or more
datasets in a MultiDataSet object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">moiraine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://solid-lamp-kq546rq.pages.github.io/">Manual</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PlantandFoodResearch/moiraine">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Target factory for datasets transformation</h1>
      <small class="dont-index">Source: <a href="https://github.com/PlantandFoodResearch/moiraine/blob/HEAD/R/transformation.R" class="external-link"><code>R/transformation.R</code></a></small>
      <div class="d-none name"><code>transformation_datasets_factory.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a list of targets to apply some transformation methods to one or more
datasets in a <code>MultiDataSet</code> object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">transformation_datasets_factory</span><span class="op">(</span></span>
<span>  <span class="va">mo_data_target</span>,</span>
<span>  <span class="va">transformations</span>,</span>
<span>  return_matrix_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  target_name_prefix <span class="op">=</span> <span class="st">""</span>,</span>
<span>  transformed_data_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log_bases <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  pre_log_functions <span class="op">=</span> <span class="va">zero_to_half_min</span>,</span>
<span>  <span class="va">methods</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mo_data_target</dt>
<dd><p>Symbol, the name of the target containing the
<code>MultiDataSet</code> object.</p></dd>


<dt>transformations</dt>
<dd><p>Named character vector, name of each element is the
name of a dataset to transform, corresponding element gives the type of
transformation to apply to the dataset (e.g. <code>c(rnaseq = 'vst-deseq2', phenotypes = 'best-normalize-auto')</code>). See Details for a list of available
transformations. If <code>'best-normalize-auto'</code> is selected, need to provide
the <code>methods</code> argument as well.</p></dd>


<dt>return_matrix_only</dt>
<dd><p>Logical, should only the transformed matrix be
returned for each transformation? If <code>TRUE</code>, only transformed matrices will
be stored. If <code>FALSE</code>, instead for each transformation, a list with the
transformed data and potentially other information relevant to the
transformation will be saved. Default value is <code>FALSE</code>.</p></dd>


<dt>target_name_prefix</dt>
<dd><p>Character, a prefix to add to the name of the
targets created by this target factory. Default value is <code>""</code>.</p></dd>


<dt>transformed_data_name</dt>
<dd><p>Character, the name of the target containing the
<code>MultiDataSet</code> with transformed data to be created. If <code>NULL</code>, will be
selected automatically. Default value is <code>NULL</code>.</p></dd>


<dt>log_bases</dt>
<dd><p>Numeric or named numeric list, gives for each dataset for
which the <code>'logx'</code> transformation is selected the log base to use. If one
value, will be used for all concerned datasets. Otherwise, can specify a
different log-base for each concerned dataset by passing a named list.</p></dd>


<dt>pre_log_functions</dt>
<dd><p>Function or named list of functions, gives for each
dataset for which the `'logx`` transformation is selected the function that
will be applied to the matrix before the log transformation (e.g. to apply
an offset to the values to avoid issues with zeros). Default value is the
<code><a href="zero_to_half_min.html">zero_to_half_min()</a></code> function. If one value, will be used for all concerned
datasets. Otherwise, can specify a different log-base for each concerned
dataset by passing a named list.</p></dd>


<dt>methods</dt>
<dd><p>Character or named character list, gives for each dataset for
which the <code>'best-normalize-manual'</code> transformation is selected the
normalisation method that should be applied. See possible values in
Details. If one value, will be used for all concerned datasets. Otherwise,
can specify a different method for each concerned dataset by passing a
named list.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to the <code><a href="transform_dataset.html">transform_dataset</a></code>
function or the <code>method</code> function from the <code>bestNormalize</code> package. Only
relevant for <code>'best-normalize-XX'</code> transformations.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of target objects. With <code>target_name_prefix = ""</code> and
<code>transformed_data_name = NULL</code>, the following targets are created:</p><ul><li><p><code>transformations_spec</code>: generates a grouped tibble where each row
corresponds to one dataset to be tranformed, with the columns specifying each
dataset name and the transformation to apply.</p></li>
<li><p><code>transformations_runs_list</code>: a dynamic branching target that runs the
<code><a href="transform_dataset.html">transform_dataset()</a></code> function on each dataset. Returns a list.</p></li>
<li><p><code>transformed_set</code>: a target that returns the <code>MultiDataSet</code> object with the
original data replaced by the transformed data.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Currently implemented transformations and recommendations based on dataset
type:</p><ul><li><p><code>vsn</code>: Variance Stabilising normalisation, implemented in the
<code><a href="https://rdrr.io/pkg/vsn/man/justvsn.html" class="external-link">vsn::justvsn()</a></code> function from the <code>vsn</code> package. This method was originally
developed for microarray intensities. This transformation is recommended for
microarray, metabolome, chemical or other intensity-based datasets. In
practice, applies the <code><a href="transform_vsn.html">transform_vsn()</a></code> function.</p></li>
<li><p><code>vst-deseq2</code>: Variance Stabilising Transformation, implemented in the
<code><a href="https://rdrr.io/pkg/DESeq2/man/varianceStabilizingTransformation.html" class="external-link">DESeq2::varianceStabilizingTransformation()</a></code> function from the <code>DESeq2</code>
package. This method is applicable to count data only. This transformation is
recommended for RNAseq or similar count-based datasets. In practice, applies
the <code><a href="transform_vst.html">transform_vst()</a></code> function.</p></li>
<li><p><code>logx</code>: log-transformation (default to log2, but base can be specified).
In practice, applies the <code><a href="transform_logx.html">transform_logx()</a></code> function.</p></li>
<li><p><code>best-normalize-auto</code>: most appropriate normalisation method automatically
selected from a number of options, implemented in the
<code><a href="https://petersonr.github.io/bestNormalize/reference/bestNormalize.html" class="external-link">bestNormalize::bestNormalize()</a></code> function from the <code>bestNormalize</code> package.
This transformation is recommended for phenotypes that are each measured on
different scales (since the transformation method selected will potentially
be different across the features), preferably with a reasonable number of
features (less than 100) to avoid large computation times. In practice,
applies the <code><a href="transform_bestNormalise_auto.html">transform_bestNormalise_auto()</a></code> function.</p></li>
<li><p><code>best-normalize-manual</code>: performs the same transformation (specified
through the <code>method</code> argument) to each feature of a dataset. This
transformation is recommended for phenotypes data in which the different
phenotypes are measured on the same scale. The different normalisation
methods are:</p><ul><li><p><code>"arcsinh_x"</code>: data is transformed as <code>log(x + sqrt(x^2 + 1))</code>;</p></li>
<li><p><code>"boxcox"</code>: Box Cox transformation;</p></li>
<li><p><code>"center_scale"</code>: data is centered and scaled;</p></li>
<li><p><code>"exp_x"</code>: data is transformed as <code>exp(x)</code>;</p></li>
<li><p><code>"log_x"</code>: data is transformed as <code>log_b(x+a)</code> (<code>a</code> and <code>b</code> either
selected automatically per variable or passed as arguments);</p></li>
<li><p><code>"orderNorm"</code>: Ordered Quantile technique;</p></li>
<li><p><code>"sqrt_x"</code>: data transformed as <code>sqrt(x + a)</code> (<code>a</code> selected automatically
per variable or passed as argument),</p></li>
<li><p><code>"yeojohnson"</code>: Yeo-Johnson transformation.</p></li>
</ul></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## in the _targets.R</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PlantandFoodResearch/moiraine" class="external-link">moiraine</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="co">## add code here to load the different datasets</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## the following target creates a MultiDataSet object from previously</span></span></span>
<span class="r-in"><span>  <span class="co">## created omics sets (geno_set, trans_set, etc)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mo_set</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="create_multiomics_set.html">create_multiomics_set</a></span><span class="op">(</span><span class="va">geno_set</span>, <span class="va">trans_set</span>, <span class="va">metabo_set</span>, <span class="va">pheno_set</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Example 1</span></span></span>
<span class="r-in"><span>  <span class="fu">transformation_datasets_factory</span><span class="op">(</span><span class="va">mo_set</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      rnaseq <span class="op">=</span> <span class="st">"vst-deseq2"</span>,</span></span>
<span class="r-in"><span>      metabolome <span class="op">=</span> <span class="st">"vsn"</span>,</span></span>
<span class="r-in"><span>      phenotypes <span class="op">=</span> <span class="st">"best-normalize-auto"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    return_matrix_only <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    transformed_data_name <span class="op">=</span> <span class="st">"mo_set_transformed"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Example 2 - with a log2 transformation for both datasets</span></span></span>
<span class="r-in"><span>  <span class="fu">transformation_datasets_factory</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mo_set_complete</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"rnaseq"</span> <span class="op">=</span> <span class="st">"logx"</span>,</span></span>
<span class="r-in"><span>      <span class="st">"metabolome"</span> <span class="op">=</span> <span class="st">"logx"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    log_bases <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    pre_log_functions <span class="op">=</span> <span class="va">zero_to_half_min</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Example 3 - with different log bases for each dataset and a different</span></span></span>
<span class="r-in"><span>  <span class="co">## preprocessing function to be run before applying the log</span></span></span>
<span class="r-in"><span>  <span class="fu">transformation_datasets_factory</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mo_set_complete</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"rnaseq"</span> <span class="op">=</span> <span class="st">"logx"</span>,</span></span>
<span class="r-in"><span>      <span class="st">"metabolome"</span> <span class="op">=</span> <span class="st">"logx"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    log_bases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rnaseq <span class="op">=</span> <span class="fl">10</span>, metabolome <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    pre_log_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      rnaseq <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>      metabolome <span class="op">=</span> <span class="va">zero_to_half_min</span></span></span>
<span class="r-in"><span>     <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Olivia Angelin-Bonnet.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

